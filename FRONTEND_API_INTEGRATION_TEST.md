# 前端API整合測試指南

## 📋 測試概述

本文件用於驗證前端與後端API優化的整合情況，確保所有新功能正常運作。

## 🧪 測試案例

### 1. 批量按讚狀態API測試

#### 測試目標
驗證批量按讚狀態API是否正常運作，減少API請求次數。

#### 測試步驟
1. **開啟瀏覽器開發者工具**
2. **進入任何有評論的頁面**（如住宿詳情頁）
3. **觀察Network標籤**
4. **檢查API請求**

#### 預期結果
```javascript
// 舊版：每個評論一個請求
GET /api/comments/1/like-status?userId=123
GET /api/comments/2/like-status?userId=123
GET /api/comments/3/like-status?userId=123
// ... N個請求

// 新版：一個批量請求
POST /api/comments/batch-like-status
{
  "commentIds": [1, 2, 3, 4, 5],
  "userId": 123
}
```

#### 成功指標
- ✅ API請求數量減少70-80%
- ✅ 頁面載入速度提升
- ✅ 按讚狀態正確顯示

### 2. 評論列表API優化測試

#### 測試目標
驗證評論列表API是否包含按讚狀態。

#### 測試步驟
1. **開啟瀏覽器開發者工具**
2. **進入評論頁面**
3. **檢查評論列表API請求**

#### 預期結果
```javascript
// 新版API請求
GET /api/comments/target/LODGING/123?includeLikeStatus=true&userId=456

// 回應格式
{
  "id": 1,
  "content": "評論內容",
  "author": { "id": 123, "name": "用戶名" },
  "likedByCurrentUser": true,  // 新增
  "likeCount": 5,              // 新增
  "images": [...]
}
```

#### 成功指標
- ✅ API回應包含按讚狀態
- ✅ 無需額外的按讚狀態請求
- ✅ 按讚按鈕狀態正確

### 3. 錯誤處理測試

#### 測試目標
驗證新的錯誤處理機制是否正常運作。

#### 測試案例

##### 3.1 速率限制錯誤
```javascript
// 快速連續按讚
for (let i = 0; i < 25; i++) {
  clickLikeButton();
}

// 預期結果
{
  "success": false,
  "message": "請求過於頻繁，請稍後再試",
  "retryAfter": 60
}
```

##### 3.2 驗證錯誤
```javascript
// 提交空評論
submitComment({
  content: "",
  rating: 6
});

// 預期結果
{
  "success": false,
  "message": "驗證失敗",
  "errors": {
    "content": "留言內容不能為空",
    "rating": "評分必須在1-5之間"
  }
}
```

#### 成功指標
- ✅ 錯誤訊息正確顯示
- ✅ 使用者體驗友善
- ✅ 錯誤處理統一

### 4. 權限檢查測試

#### 測試目標
驗證新的權限檢查機制是否正常運作。

#### 測試案例

##### 4.1 一般用戶權限
- ✅ 可以新增主評論
- ✅ 可以回覆評論
- ✅ 可以按讚
- ✅ 可以檢舉
- ✅ 可以編輯自己的評論
- ✅ 可以刪除自己的評論

##### 4.2 管理員權限
- ❌ 不能新增主評論
- ✅ 可以回覆評論
- ❌ 不能按讚
- ❌ 不能檢舉
- ✅ 可以編輯任何評論
- ✅ 可以刪除任何評論

##### 4.3 廠商權限
- ❌ 不能新增主評論
- ✅ 可以回覆評論
- ✅ 可以按讚
- ✅ 可以檢舉
- ✅ 可以編輯自己的評論
- ✅ 可以刪除自己的評論

#### 成功指標
- ✅ 權限檢查正確
- ✅ UI狀態正確顯示
- ✅ 操作被正確限制

## 🔧 手動測試步驟

### 步驟1：環境準備
```bash
# 確保前端開發伺服器運行
npm run dev

# 確保後端API伺服器運行
# 檢查 API_BASE_URL 設定
```

### 步驟2：基本功能測試
1. **登入系統**
2. **進入住宿詳情頁**
3. **查看評論列表**
4. **測試按讚功能**
5. **測試新增評論**
6. **測試回覆評論**

### 步驟3：效能測試
1. **開啟開發者工具**
2. **切換到Network標籤**
3. **重新載入頁面**
4. **記錄API請求數量**
5. **比較優化前後的差異**

### 步驟4：錯誤測試
1. **測試網路中斷情況**
2. **測試無效輸入**
3. **測試權限不足情況**
4. **測試速率限制**

## 📊 測試結果記錄

### 效能改善記錄
| 測試項目 | 優化前 | 優化後 | 改善幅度 |
|---------|--------|--------|----------|
| API請求數量 | 15個 | 3個 | 80% |
| 頁面載入時間 | 2.5秒 | 1.2秒 | 52% |
| 按讚響應時間 | 500ms | 200ms | 60% |

### 功能測試記錄
| 功能 | 狀態 | 備註 |
|------|------|------|
| 批量按讚狀態 | ✅ 正常 | API請求減少 |
| 評論列表優化 | ✅ 正常 | 包含按讚狀態 |
| 錯誤處理 | ✅ 正常 | 統一錯誤訊息 |
| 權限檢查 | ✅ 正常 | 權限正確限制 |

## 🐛 常見問題排查

### 問題1：批量API請求失敗
**症狀**：按讚狀態無法載入
**解決方案**：
1. 檢查後端API是否正常運行
2. 檢查API端點是否正確
3. 檢查請求格式是否正確

### 問題2：按讚狀態不正確
**症狀**：按讚按鈕狀態錯誤
**解決方案**：
1. 檢查用戶ID是否正確
2. 檢查API回應格式
3. 檢查前端狀態更新邏輯

### 問題3：權限檢查錯誤
**症狀**：權限限制不正確
**解決方案**：
1. 檢查用戶類型設定
2. 檢查權限檢查邏輯
3. 檢查UI顯示邏輯

## 📝 測試報告模板

### 測試環境
- **前端版本**：v1.0.0
- **後端版本**：v1.0.0
- **瀏覽器**：Chrome 120.0
- **測試日期**：2024-01-15

### 測試結果摘要
- **總測試案例**：12個
- **通過**：11個
- **失敗**：1個
- **成功率**：91.7%

### 發現問題
1. **問題描述**：速率限制錯誤訊息顯示不正確
2. **嚴重程度**：中等
3. **影響範圍**：使用者體驗
4. **建議解決方案**：修正錯誤訊息格式

### 建議改進
1. 增加更多錯誤測試案例
2. 實作自動化測試
3. 改善錯誤訊息本地化
4. 增加效能監控

---

*最後更新：2024-01-15*
*測試人員：[姓名]* 