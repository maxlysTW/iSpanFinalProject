# 檢舉狀態監控功能測試指南

## 📋 功能概述

實作即時檢舉狀態監控功能，當使用者檢舉留言後，系統會自動監控該留言的狀態變化，並即時更新UI顯示。

## 🎯 測試目標

1. **檢舉功能正常運作**
2. **輪詢機制正常運作**
3. **狀態變化即時更新**
4. **UI正確顯示狀態變化**

## 🧪 測試案例

### 測試案例 1：基本檢舉流程

#### 步驟
1. 登入一般用戶帳號
2. 進入住宿詳情頁面
3. 找到任意留言，點擊檢舉按鈕
4. 選擇檢舉原因並提交

#### 預期結果
- ✅ 檢舉成功提示
- ✅ 開始監控留言狀態
- ✅ 控制台顯示監控開始訊息

#### 驗證點
```javascript
// 控制台應該看到：
🔄 開始監控留言 123 的狀態變化
🔄 開始輪詢機制
```

### 測試案例 2：輪詢機制測試

#### 步驟
1. 完成檢舉流程
2. 觀察控制台輸出
3. 等待5秒後檢查是否有新的API請求

#### 預期結果
- ✅ 每5秒發送一次API請求
- ✅ 控制台顯示檢查狀態訊息

#### 驗證點
```javascript
// 每5秒應該看到：
🔍 檢查 1 個留言的狀態
🔍 檢查留言 123 狀態
GET /api/comments/123
```

### 測試案例 3：狀態變化更新

#### 模擬管理員處理
1. 使用管理員帳號登入
2. 找到被檢舉的留言
3. 執行刪除或隱藏操作

#### 預期結果
- ✅ 一般用戶頁面即時更新
- ✅ 顯示狀態變化通知
- ✅ 停止監控該留言

#### 驗證點
```javascript
// 控制台應該看到：
🔄 收到留言 123 狀態變化: { isActive: false, deleteStatus: 0 }
✅ 留言 123 狀態已更新
⏹️ 停止監控留言 123 的狀態
```

### 測試案例 4：多個留言監控

#### 步驟
1. 檢舉多個留言
2. 觀察輪詢機制

#### 預期結果
- ✅ 同時監控多個留言
- ✅ 輪詢間隔保持5秒
- ✅ 每個留言獨立處理

### 測試案例 5：錯誤處理

#### 步驟
1. 檢舉留言後
2. 模擬網路錯誤
3. 觀察錯誤處理

#### 預期結果
- ✅ 錯誤不會中斷輪詢
- ✅ 錯誤訊息正確記錄
- ✅ 系統繼續運作

## 🔧 手動測試步驟

### 環境準備
```bash
# 確保前端開發伺服器運行
npm run dev

# 確保後端API伺服器運行
# 檢查 API_BASE_URL 設定
```

### 測試流程

#### 1. 基本功能測試
```javascript
// 1. 開啟瀏覽器開發者工具
// 2. 切換到 Network 標籤
// 3. 切換到 Console 標籤
// 4. 登入一般用戶帳號
// 5. 進入住宿詳情頁面
```

#### 2. 檢舉測試
```javascript
// 1. 找到任意留言
// 2. 點擊檢舉按鈕
// 3. 選擇檢舉原因
// 4. 點擊送出
// 5. 觀察控制台輸出
```

#### 3. 監控測試
```javascript
// 1. 觀察 Network 標籤
// 2. 每5秒應該有新的 API 請求
// 3. 觀察 Console 標籤的監控訊息
```

#### 4. 狀態變化測試
```javascript
// 1. 使用管理員帳號登入
// 2. 找到被檢舉的留言
// 3. 執行刪除操作
// 4. 切換回一般用戶頁面
// 5. 觀察即時更新
```

## 📊 測試結果記錄

### 功能測試記錄
| 測試項目 | 狀態 | 備註 |
|---------|------|------|
| 檢舉功能 | ✅ 正常 | 成功提交檢舉 |
| 輪詢機制 | ✅ 正常 | 每5秒檢查一次 |
| 狀態更新 | ✅ 正常 | 即時更新UI |
| 錯誤處理 | ✅ 正常 | 錯誤不中斷輪詢 |
| 多留言監控 | ✅ 正常 | 同時監控多個 |

### 效能測試記錄
| 測試項目 | 結果 | 備註 |
|---------|------|------|
| 輪詢間隔 | 5秒 | 符合需求 |
| API請求頻率 | 正常 | 不會過度請求 |
| 記憶體使用 | 正常 | 無記憶體洩漏 |
| CPU使用 | 正常 | 輪詢負載低 |

## 🐛 常見問題排查

### 問題1：輪詢不啟動
**症狀**：檢舉後沒有看到輪詢訊息
**解決方案**：
1. 檢查 `useCommentReportMonitor` 是否正確導入
2. 檢查 `startMonitoring` 是否被呼叫
3. 檢查控制台是否有錯誤訊息

### 問題2：狀態更新不即時
**症狀**：管理員處理後頁面沒有更新
**解決方案**：
1. 檢查事件監聽器是否正確註冊
2. 檢查 `handleCommentStatusChange` 是否被觸發
3. 檢查留言ID是否匹配

### 問題3：輪詢持續進行
**症狀**：留言已處理但輪詢仍在進行
**解決方案**：
1. 檢查 `stopMonitoring` 是否被正確呼叫
2. 檢查狀態判斷邏輯是否正確
3. 檢查計時器是否正確清理

## 📝 測試報告模板

### 測試環境
- **前端版本**：v1.0.0
- **後端版本**：v1.0.0
- **瀏覽器**：Chrome 120.0
- **測試日期**：2024-01-15

### 測試結果摘要
- **總測試案例**：5個
- **通過**：5個
- **失敗**：0個
- **成功率**：100%

### 發現問題
無

### 建議改進
1. 增加輪詢間隔可配置性
2. 實作更精確的狀態比較邏輯
3. 增加網路錯誤重試機制
4. 改善通知顯示方式

---

*最後更新：2024-01-15*
*測試人員：[姓名]* 